<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Vectorisation with Deep Learning Project: src.post_processing Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Vectorisation with Deep Learning Project
   </div>
   <div id="projectbrief">A Python project for generating line drawings and training Neural Network models for line vectorization.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacesrc.html">src</a></li><li class="navelem"><a class="el" href="namespacesrc_1_1post__processing.html">post_processing</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">src.post_processing Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af066920fecf65056aea4b976c08202f4" id="r_af066920fecf65056aea4b976c08202f4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af066920fecf65056aea4b976c08202f4">post_process_mask</a> (mask)</td></tr>
<tr class="separator:af066920fecf65056aea4b976c08202f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1233fc1ece9488e4cd6424c6ed510037" id="r_a1233fc1ece9488e4cd6424c6ed510037"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1233fc1ece9488e4cd6424c6ed510037">detect_lines_skeleton</a> (skeleton)</td></tr>
<tr class="separator:a1233fc1ece9488e4cd6424c6ed510037"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a335a9b6ec03df58adac88ad3660ea8a6" id="r_a335a9b6ec03df58adac88ad3660ea8a6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a335a9b6ec03df58adac88ad3660ea8a6">merge_nearby_lines</a> (lines, proximity_threshold=10, angle_threshold=5)</td></tr>
<tr class="separator:a335a9b6ec03df58adac88ad3660ea8a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a1ce001686e9ac518d35bd587560fa7" id="r_a4a1ce001686e9ac518d35bd587560fa7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4a1ce001686e9ac518d35bd587560fa7">refine_and_save_as_svg</a> (pred_masks, svg_output_dir='vectorized_svgs_final_please')</td></tr>
<tr class="separator:a4a1ce001686e9ac518d35bd587560fa7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5acd8a5096594413cadce4e0e0a2651" id="r_ab5acd8a5096594413cadce4e0e0a2651"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab5acd8a5096594413cadce4e0e0a2651">debug_detected_lines</a> (skeleton, lines)</td></tr>
<tr class="separator:ab5acd8a5096594413cadce4e0e0a2651"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">@file post_processing.py
@brief Module for post-processing model predictions.

This module provides functions to perform skeletonization, line detection using Hough Transform,
merging of nearby lines, and saving refined masks as SVG files.
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="ab5acd8a5096594413cadce4e0e0a2651" name="ab5acd8a5096594413cadce4e0e0a2651"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5acd8a5096594413cadce4e0e0a2651">&#9670;&#160;</a></span>debug_detected_lines()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">src.post_processing.debug_detected_lines </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>skeleton</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>lines</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Visualizes detected lines on a skeletonized mask for debugging purposes.

This function plots the skeleton image and overlays the detected lines.

@param skeleton (numpy.ndarray): Skeletonized binary mask.
@param lines (numpy.ndarray or None): Detected lines from Hough Transform.

@return None
</pre> 
<p class="definition">Definition at line <a class="el" href="post__processing_8py_source.html#l00136">136</a> of file <a class="el" href="post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  136</span><span class="keyword">def </span>debug_detected_lines(skeleton, lines):</div>
<div class="line"><span class="lineno">  137</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  138</span><span class="stringliteral">    @brief Visualizes detected lines on a skeletonized mask for debugging purposes.</span></div>
<div class="line"><span class="lineno">  139</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  140</span><span class="stringliteral">    This function plots the skeleton image and overlays the detected lines.</span></div>
<div class="line"><span class="lineno">  141</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  142</span><span class="stringliteral">    @param skeleton (numpy.ndarray): Skeletonized binary mask.</span></div>
<div class="line"><span class="lineno">  143</span><span class="stringliteral">    @param lines (numpy.ndarray or None): Detected lines from Hough Transform.</span></div>
<div class="line"><span class="lineno">  144</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  145</span><span class="stringliteral">    @return None</span></div>
<div class="line"><span class="lineno">  146</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  147</span>    plt.figure()</div>
<div class="line"><span class="lineno">  148</span>    plt.imshow(skeleton, cmap=<span class="stringliteral">&quot;gray&quot;</span>)</div>
<div class="line"><span class="lineno">  149</span>    <span class="keywordflow">if</span> lines <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  150</span>        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> lines:</div>
<div class="line"><span class="lineno">  151</span>            <span class="keywordflow">for</span> x1, y1, x2, y2 <span class="keywordflow">in</span> line:</div>
<div class="line"><span class="lineno">  152</span>                plt.plot([x1, x2], [y1, y2], <span class="stringliteral">&#39;r-&#39;</span>, linewidth=2)</div>
<div class="line"><span class="lineno">  153</span>    plt.title(<span class="stringliteral">&quot;Detected Lines on Skeleton&quot;</span>)</div>
<div class="line"><span class="lineno">  154</span>    plt.axis(<span class="stringliteral">&quot;off&quot;</span>)</div>
<div class="line"><span class="lineno">  155</span>    plt.show()</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1233fc1ece9488e4cd6424c6ed510037" name="a1233fc1ece9488e4cd6424c6ed510037"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1233fc1ece9488e4cd6424c6ed510037">&#9670;&#160;</a></span>detect_lines_skeleton()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">src.post_processing.detect_lines_skeleton </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>skeleton</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Detects lines in a skeletonized mask using Probabilistic Hough Transform.

This function applies the Hough Line Transform to detect lines within the skeleton.

@param skeleton (numpy.ndarray): Skeletonized binary mask.

@return numpy.ndarray or None: Detected lines as an array of endpoints or None if no lines detected.
</pre> 
<p class="definition">Definition at line <a class="el" href="post__processing_8py_source.html#l00034">34</a> of file <a class="el" href="post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   34</span><span class="keyword">def </span>detect_lines_skeleton(skeleton):</div>
<div class="line"><span class="lineno">   35</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   36</span><span class="stringliteral">    @brief Detects lines in a skeletonized mask using Probabilistic Hough Transform.</span></div>
<div class="line"><span class="lineno">   37</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   38</span><span class="stringliteral">    This function applies the Hough Line Transform to detect lines within the skeleton.</span></div>
<div class="line"><span class="lineno">   39</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   40</span><span class="stringliteral">    @param skeleton (numpy.ndarray): Skeletonized binary mask.</span></div>
<div class="line"><span class="lineno">   41</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   42</span><span class="stringliteral">    @return numpy.ndarray or None: Detected lines as an array of endpoints or None if no lines detected.</span></div>
<div class="line"><span class="lineno">   43</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   44</span>    lines = cv2.HoughLinesP(</div>
<div class="line"><span class="lineno">   45</span>        skeleton,</div>
<div class="line"><span class="lineno">   46</span>        rho=1,</div>
<div class="line"><span class="lineno">   47</span>        theta=np.pi / 180,</div>
<div class="line"><span class="lineno">   48</span>        threshold=30,        <span class="comment"># Slightly increased for better precision</span></div>
<div class="line"><span class="lineno">   49</span>        minLineLength=2,</div>
<div class="line"><span class="lineno">   50</span>        maxLineGap=3         <span class="comment"># Reduced to avoid over-connecting</span></div>
<div class="line"><span class="lineno">   51</span>    )</div>
<div class="line"><span class="lineno">   52</span>    <span class="keywordflow">return</span> lines</div>
<div class="line"><span class="lineno">   53</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a335a9b6ec03df58adac88ad3660ea8a6" name="a335a9b6ec03df58adac88ad3660ea8a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a335a9b6ec03df58adac88ad3660ea8a6">&#9670;&#160;</a></span>merge_nearby_lines()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">src.post_processing.merge_nearby_lines </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>lines</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>proximity_threshold</em></span><span class="paramdefsep"> = </span><span class="paramdefval">10</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>angle_threshold</em></span><span class="paramdefsep"> = </span><span class="paramdefval">5</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Merges duplicate or nearby lines based on proximity and angle thresholds.

This function iterates through detected lines and merges lines that are close to each other
and have similar orientations.

@param lines (numpy.ndarray or None): Detected lines from Hough Transform.
@param proximity_threshold (int, optional): Maximum distance between lines to consider merging. Default is 10.
@param angle_threshold (float, optional): Maximum angle difference in degrees to consider merging. Default is 5.

@return numpy.ndarray or None: Merged lines or None if no lines to merge.
</pre> 
<p class="definition">Definition at line <a class="el" href="post__processing_8py_source.html#l00054">54</a> of file <a class="el" href="post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   54</span><span class="keyword">def </span>merge_nearby_lines(lines, proximity_threshold=10, angle_threshold=5):</div>
<div class="line"><span class="lineno">   55</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   56</span><span class="stringliteral">    @brief Merges duplicate or nearby lines based on proximity and angle thresholds.</span></div>
<div class="line"><span class="lineno">   57</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   58</span><span class="stringliteral">    This function iterates through detected lines and merges lines that are close to each other</span></div>
<div class="line"><span class="lineno">   59</span><span class="stringliteral">    and have similar orientations.</span></div>
<div class="line"><span class="lineno">   60</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   61</span><span class="stringliteral">    @param lines (numpy.ndarray or None): Detected lines from Hough Transform.</span></div>
<div class="line"><span class="lineno">   62</span><span class="stringliteral">    @param proximity_threshold (int, optional): Maximum distance between lines to consider merging. Default is 10.</span></div>
<div class="line"><span class="lineno">   63</span><span class="stringliteral">    @param angle_threshold (float, optional): Maximum angle difference in degrees to consider merging. Default is 5.</span></div>
<div class="line"><span class="lineno">   64</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   65</span><span class="stringliteral">    @return numpy.ndarray or None: Merged lines or None if no lines to merge.</span></div>
<div class="line"><span class="lineno">   66</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   67</span>    <span class="keywordflow">if</span> lines <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">   68</span>        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   69</span> </div>
<div class="line"><span class="lineno">   70</span>    merged_lines = []</div>
<div class="line"><span class="lineno">   71</span>    <span class="keywordflow">for</span> line <span class="keywordflow">in</span> lines:</div>
<div class="line"><span class="lineno">   72</span>        x1, y1, x2, y2 = line[0]</div>
<div class="line"><span class="lineno">   73</span>        merged = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">   74</span>        <span class="keywordflow">for</span> m_line <span class="keywordflow">in</span> merged_lines:</div>
<div class="line"><span class="lineno">   75</span>            mx1, my1, mx2, my2 = m_line[0]</div>
<div class="line"><span class="lineno">   76</span> </div>
<div class="line"><span class="lineno">   77</span>            <span class="comment"># Calculate proximity and angle</span></div>
<div class="line"><span class="lineno">   78</span>            distance = np.sqrt((x1 - mx1)**2 + (y1 - my1)**2)</div>
<div class="line"><span class="lineno">   79</span>            angle_diff = np.abs(</div>
<div class="line"><span class="lineno">   80</span>                np.arctan2(y2 - y1, x2 - x1) - np.arctan2(my2 - my1, mx2 - mx1)</div>
<div class="line"><span class="lineno">   81</span>            ) * 180 / np.pi</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>            <span class="keywordflow">if</span> distance &lt; proximity_threshold <span class="keywordflow">and</span> angle_diff &lt; angle_threshold:</div>
<div class="line"><span class="lineno">   84</span>                <span class="comment"># Merge lines by averaging their endpoints</span></div>
<div class="line"><span class="lineno">   85</span>                new_x1 = int((x1 + mx1) / 2)</div>
<div class="line"><span class="lineno">   86</span>                new_y1 = int((y1 + my1) / 2)</div>
<div class="line"><span class="lineno">   87</span>                new_x2 = int((x2 + mx2) / 2)</div>
<div class="line"><span class="lineno">   88</span>                new_y2 = int((y2 + my2) / 2)</div>
<div class="line"><span class="lineno">   89</span>                m_line[0] = [new_x1, new_y1, new_x2, new_y2]</div>
<div class="line"><span class="lineno">   90</span>                merged = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">   91</span>                <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">   92</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> merged:</div>
<div class="line"><span class="lineno">   93</span>            merged_lines.append(line)</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span>    <span class="keywordflow">return</span> np.array(merged_lines)</div>
<div class="line"><span class="lineno">   96</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="af066920fecf65056aea4b976c08202f4" name="af066920fecf65056aea4b976c08202f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af066920fecf65056aea4b976c08202f4">&#9670;&#160;</a></span>post_process_mask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">src.post_processing.post_process_mask </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>mask</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Performs skeletonization and morphological cleaning on a predicted mask.

This function skeletonizes the binary mask to reduce lines to single-pixel width,
then applies dilation to connect fragmented lines.

@param mask (numpy.ndarray): Predicted binary mask with shape (160, 160, 1).

@return numpy.ndarray: Post-processed binary mask.
</pre> 
<p class="definition">Definition at line <a class="el" href="post__processing_8py_source.html#l00015">15</a> of file <a class="el" href="post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   15</span><span class="keyword">def </span>post_process_mask(mask):</div>
<div class="line"><span class="lineno">   16</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   17</span><span class="stringliteral">    @brief Performs skeletonization and morphological cleaning on a predicted mask.</span></div>
<div class="line"><span class="lineno">   18</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   19</span><span class="stringliteral">    This function skeletonizes the binary mask to reduce lines to single-pixel width,</span></div>
<div class="line"><span class="lineno">   20</span><span class="stringliteral">    then applies dilation to connect fragmented lines.</span></div>
<div class="line"><span class="lineno">   21</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   22</span><span class="stringliteral">    @param mask (numpy.ndarray): Predicted binary mask with shape (160, 160, 1).</span></div>
<div class="line"><span class="lineno">   23</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   24</span><span class="stringliteral">    @return numpy.ndarray: Post-processed binary mask.</span></div>
<div class="line"><span class="lineno">   25</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   26</span>    mask = mask.squeeze()</div>
<div class="line"><span class="lineno">   27</span>    mask = mask.astype(np.uint8)</div>
<div class="line"><span class="lineno">   28</span>    <span class="comment"># Skeletonize the mask</span></div>
<div class="line"><span class="lineno">   29</span>    skeleton = skeletonize(mask).astype(np.uint8)</div>
<div class="line"><span class="lineno">   30</span>    <span class="comment"># Apply dilation to connect fragmented lines</span></div>
<div class="line"><span class="lineno">   31</span>    skeleton = binary_dilation(skeleton, disk(1)).astype(np.uint8)</div>
<div class="line"><span class="lineno">   32</span>    <span class="keywordflow">return</span> skeleton</div>
<div class="line"><span class="lineno">   33</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a4a1ce001686e9ac518d35bd587560fa7" name="a4a1ce001686e9ac518d35bd587560fa7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a1ce001686e9ac518d35bd587560fa7">&#9670;&#160;</a></span>refine_and_save_as_svg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">src.post_processing.refine_and_save_as_svg </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>pred_masks</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>svg_output_dir</em></span><span class="paramdefsep"> = </span><span class="paramdefval">'vectorized_svgs_final_please'</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">@brief Refines predicted masks and saves them as SVG files.

This function post-processes predicted masks, detects lines, merges nearby lines,
and saves the refined lines as SVG files.

@param pred_masks (numpy.ndarray): Predicted masks with shape (num_samples, 160, 160, 1).
@param svg_output_dir (str, optional): Directory to save the SVG files. Default is 'vectorized_svgs_final_please'.

@return None
</pre> 
<p class="definition">Definition at line <a class="el" href="post__processing_8py_source.html#l00097">97</a> of file <a class="el" href="post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   97</span><span class="keyword">def </span>refine_and_save_as_svg(pred_masks, svg_output_dir=&#39;vectorized_svgs_final_please&#39;):</div>
<div class="line"><span class="lineno">   98</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   99</span><span class="stringliteral">    @brief Refines predicted masks and saves them as SVG files.</span></div>
<div class="line"><span class="lineno">  100</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  101</span><span class="stringliteral">    This function post-processes predicted masks, detects lines, merges nearby lines,</span></div>
<div class="line"><span class="lineno">  102</span><span class="stringliteral">    and saves the refined lines as SVG files.</span></div>
<div class="line"><span class="lineno">  103</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  104</span><span class="stringliteral">    @param pred_masks (numpy.ndarray): Predicted masks with shape (num_samples, 160, 160, 1).</span></div>
<div class="line"><span class="lineno">  105</span><span class="stringliteral">    @param svg_output_dir (str, optional): Directory to save the SVG files. Default is &#39;vectorized_svgs_final_please&#39;.</span></div>
<div class="line"><span class="lineno">  106</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  107</span><span class="stringliteral">    @return None</span></div>
<div class="line"><span class="lineno">  108</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  109</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(svg_output_dir):</div>
<div class="line"><span class="lineno">  110</span>        os.makedirs(svg_output_dir)</div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>    <span class="keywordflow">for</span> i, mask <span class="keywordflow">in</span> enumerate(pred_masks):</div>
<div class="line"><span class="lineno">  113</span>        skeleton = post_process_mask(mask)</div>
<div class="line"><span class="lineno">  114</span>        lines = detect_lines_skeleton(skeleton)</div>
<div class="line"><span class="lineno">  115</span>        filtered_lines = merge_nearby_lines(lines)</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>        <span class="keywordflow">if</span> filtered_lines <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  118</span>            <span class="comment"># Save as SVG</span></div>
<div class="line"><span class="lineno">  119</span>            svg_filename = f<span class="stringliteral">&quot;sample_{i:03d}.svg&quot;</span></div>
<div class="line"><span class="lineno">  120</span>            svg_path = os.path.join(svg_output_dir, svg_filename)</div>
<div class="line"><span class="lineno">  121</span>            height, width = skeleton.shape</div>
<div class="line"><span class="lineno">  122</span>            dwg = svgwrite.Drawing(svg_path, size=(width, height))</div>
<div class="line"><span class="lineno">  123</span>            <span class="keywordflow">for</span> line <span class="keywordflow">in</span> filtered_lines:</div>
<div class="line"><span class="lineno">  124</span>                <span class="keywordflow">for</span> x1, y1, x2, y2 <span class="keywordflow">in</span> line:</div>
<div class="line"><span class="lineno">  125</span>                    x1, y1, x2, y2 = map(int, [x1, y1, x2, y2])</div>
<div class="line"><span class="lineno">  126</span>                    dwg.add(dwg.line(</div>
<div class="line"><span class="lineno">  127</span>                        start=(x1, y1),</div>
<div class="line"><span class="lineno">  128</span>                        end=(x2, y2),</div>
<div class="line"><span class="lineno">  129</span>                        stroke=<span class="stringliteral">&quot;rgb(10,10,16)&quot;</span>,</div>
<div class="line"><span class="lineno">  130</span>                        stroke_width=2</div>
<div class="line"><span class="lineno">  131</span>                    ))</div>
<div class="line"><span class="lineno">  132</span>            dwg.save()</div>
<div class="line"><span class="lineno">  133</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  134</span>            print(f<span class="stringliteral">&quot;No lines detected for sample {i}&quot;</span>)</div>
<div class="line"><span class="lineno">  135</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacesrc_1_1post__processing_a4a1ce001686e9ac518d35bd587560fa7_cgraph.png" border="0" usemap="#anamespacesrc_1_1post__processing_a4a1ce001686e9ac518d35bd587560fa7_cgraph" alt=""/></div>
<map name="anamespacesrc_1_1post__processing_a4a1ce001686e9ac518d35bd587560fa7_cgraph" id="anamespacesrc_1_1post__processing_a4a1ce001686e9ac518d35bd587560fa7_cgraph">
<area shape="rect" title=" " alt="" coords="5,71,180,111"/>
<area shape="rect" href="namespacesrc_1_1post__processing.html#a1233fc1ece9488e4cd6424c6ed510037" title=" " alt="" coords="228,5,406,46"/>
<area shape="poly" title=" " alt="" coords="164,68,229,48,230,54,165,73"/>
<area shape="rect" href="namespacesrc_1_1post__processing.html#a335a9b6ec03df58adac88ad3660ea8a6" title=" " alt="" coords="228,71,406,111"/>
<area shape="poly" title=" " alt="" coords="180,88,212,88,212,94,180,94"/>
<area shape="rect" href="namespacesrc_1_1post__processing.html#af066920fecf65056aea4b976c08202f4" title=" " alt="" coords="233,136,400,177"/>
<area shape="poly" title=" " alt="" coords="165,109,230,128,229,134,164,114"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
